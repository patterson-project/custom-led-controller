import datetime
import math

import rpi_ws281x


def wheel(pos) -> rpi_ws281x.Color:
    if pos < 85:
        return rpi_ws281x.Color(pos * 3, 255 - pos * 3, 0)
    elif pos < 170:
        pos -= 85
        return rpi_ws281x.Color(255 - pos * 3, 0, pos * 3)
    else:
        pos -= 170
        return rpi_ws281x.Color(0, pos * 3, 255 - pos * 3)


def convert_ha_temperature(temperature):
    if temperature < 154:
        temperature = 154
    elif temperature >= 400:
        temperature = 346
    
    if temperature > 250:
        final_temperature = 1960 - abs(1960 - ((temperature*10) - 540))
    elif temperature < 250:
        final_temperature = 1960 + abs(1960 - ((temperature*10) - 540))
    
    return final_temperature    

def convert_K_to_RGB(colour_temperature) -> tuple[int, int, int]:
    # range check
    if colour_temperature < 1000:
        colour_temperature = 1000
    elif colour_temperature > 40000:
        colour_temperature = 40000

    tmp_internal = colour_temperature / 100.0

    # red
    if tmp_internal <= 66:
        red = 255
    else:
        tmp_red = 329.698727446 * math.pow(tmp_internal - 60, -0.1332047592)
        if tmp_red < 0:
            red = 0
        elif tmp_red > 255:
            red = 255
        else:
            red = tmp_red

    # green
    if tmp_internal <= 66:
        tmp_green = 99.4708025861 * math.log(tmp_internal) - 161.1195681661
        if tmp_green < 0:
            green = 0
        elif tmp_green > 255:
            green = 255
        else:
            green = tmp_green
    else:
        tmp_green = 288.1221695283 * math.pow(tmp_internal - 60, -0.0755148492)
        if tmp_green < 0:
            green = 0
        elif tmp_green > 255:
            green = 255
        else:
            green = tmp_green

    # blue
    if tmp_internal >= 66:
        blue = 255
    elif tmp_internal <= 19:
        blue = 0
    else:
        tmp_blue = 138.5177312231 * \
            math.log(tmp_internal - 10) - 305.0447927307
        if tmp_blue < 0:
            blue = 0
        elif tmp_blue > 255:
            blue = 255
        else:
            blue = tmp_blue

    return int(red), int(green), int(blue)
